{"data":{"site":{"siteMetadata":{"title":"HappySchool","author":"Peter Wang"}},"markdownRemark":{"id":"825c3bde-f4f5-5bdd-8264-877dc2ee2f66","html":"<p>Nervos CKB , that is the layer1 blockchain for Nervos network, testnet launched on May 18th. In this episode I will take you through the process of running a CKB node and mining CKB blocks to get reward. We will be using MacOS as the operating system, CKB Javascript SDK to generate wallet, and the blockchain’s explorer to view results.</p>\n<h2 id=\"how-things-fit-together\"><a href=\"#how-things-fit-together\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How Things Fit Together</h2>\n<p>Before getting hands dirty, let’s first look at the big picture to see how things fit together. </p>\n<p>In order to mine CKB, you need to run your own node first, but what is a node? The answer is simple</p>\n<blockquote>\n<p>A node is a computer with CKB client installed.</p>\n</blockquote>\n<p>I will show you how to download the client software and install it soon enough.</p>\n<p>And what is CKB testnet? CKB is a blockchain, a peer to peer network, which means there is no server, so the testnet is nothing but all the CKB nodes together, the nodes talk to each other, and reach consensus on data to make the whole chain trust worthy. Testnet is different from mainnet in that it is here for testing things.</p>\n<p><img src=\"https://img.haoqicat.com/2019052402.jpg\"></p>\n<p>A SDK is a piece of code that help you interact with CKB network. In this episode, Javascript version of the SDK will be used, so in order to follow along, You might need to have basic understanding of how Javascript and Nodejs works. But there are SDKs for other languages too, check the official doc site <a href=\"https://docs.nervos.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.nervos.org</a> for more on that. </p>\n<p>The process goes like this. I will first show you how to setup a node, then using the SDK to generate a wallet of your own, now change the node config to use your own wallet, so that the mining reward will be saved to the wallet. Then I will start to mine the block, and mining means to use my laptop’s computing power to find a hash that match the network’s requirement, once I find the hash, that means I find the seal for the block, I can publish the block to the network and get certain amount of CKB coins as the reward. And finally, I will show you how to use CKB blockchain explorer to check your rewards.</p>\n<p><img src=\"https://img.haoqicat.com/2019052403.jpg\"></p>\n<p>Finally be warned. The testnet will be reset every two weeks, so any coins you have on the testnet will be cleared upon the reset.</p>\n<h2 id=\"run-a-node\"><a href=\"#run-a-node\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Run a node</h2>\n<p>OK, let’s setup a node. </p>\n<p>Firstly, download the binary from official Github repo</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wget https://github.com/nervosnetwork/ckb/releases/download/v0.12.0/ckb_v0.12.0_darwin_amd64.zip</code></pre></div>\n<p>Uncompress the zip file</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">unzip ckb_v0.12.0_darwin_amd64.zip\ncd ckb_v0.12.0_darwin_amd64</code></pre></div>\n<p>Run this command to make <code class=\"language-text\">ckb</code> a system command. It’s a typical unix trick to create a symlink, but it’s OK for you not to understand what a symlink is for now.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo ln -snf &quot;$(pwd)/ckb&quot; /usr/local/bin/ckb</code></pre></div>\n<p>Then check if it works by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ckb --version</code></pre></div>\n<p>Now that CKB client is installed, I can generate the default configuration files for the testnet with</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ckb init -C ckb-testnet --spec testnet</code></pre></div>\n<p>We created a folder named ckb-testnet, and generated config files in it.</p>\n<p>Go inside the folder and start CKB software</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd ckb-testnet\nckb run</code></pre></div>\n<p>In the console output we see that my node is downloading the whole blockchain from other nodes, this will take sometime. You can go to <a href=\"https://explorer.nervos.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://explorer.nervos.org/</a> to know the latest block height, so that you will get a sense of how long the downloading will take.</p>\n<p>Once the downloading finished, we have our node up and running, awesome~~~</p>\n<h2 id=\"use-your-own-wallet\"><a href=\"#use-your-own-wallet\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use Your Own Wallet</h2>\n<p>Now I need to generate my own wallet and replace the default configuration for the local node, so that the mining reward goes to my own wallet.</p>\n<p>Firstly, create a simple Nodejs project. Be aware that this project is not part of the CKB node, and it’s only used to generate a wallet for us. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node --version\nv10.10.0</code></pre></div>\n<p>The code will use some new JS features like async/await, so make sure your Nodejs version is not too old, mine is 10.10, please use a same or greater version.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir gen-wallet\ncd gen-wallet\nnode init -y</code></pre></div>\n<p>Create a folder to save the node project, run <code class=\"language-text\">node init</code> to generate a package.json file.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @nervosnetwork/ckb-sdk-core</code></pre></div>\n<p>And install the JS SDK as a npm package.</p>\n<p>Now create a file named index.js with demo code from the JS SDK official repo <a href=\"https://github.com/nervosnetwork/ckb-sdk-js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/nervosnetwork/ckb-sdk-js</a> .</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">EC</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'elliptic'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ec\n<span class=\"token keyword\">const</span> Core <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@nervosnetwork/ckb-sdk-core'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span>\n<span class=\"token keyword\">const</span> Address <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@nervosnetwork/ckb-sdk-address'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span>\n\n<span class=\"token keyword\">const</span> ec <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EC</span><span class=\"token punctuation\">(</span><span class=\"token string\">'secp256k1'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> privateKey <span class=\"token operator\">=</span> ec<span class=\"token punctuation\">.</span><span class=\"token function\">genKeyPair</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> address <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span>privateKey<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> prefix<span class=\"token punctuation\">:</span> <span class=\"token string\">'ckt'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'privateKey: '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0x'</span> <span class=\"token operator\">+</span> address<span class=\"token punctuation\">.</span><span class=\"token function\">getPrivateKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'address: '</span><span class=\"token punctuation\">,</span> address<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">const</span> nodeUrl <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_URL</span> <span class=\"token operator\">||</span> <span class=\"token string\">'http://localhost:8114'</span>\n\n<span class=\"token keyword\">const</span> core <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Core</span><span class=\"token punctuation\">(</span>nodeUrl<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> bootstrap <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> systemCellInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> core<span class=\"token punctuation\">.</span><span class=\"token function\">loadSystemCell</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">SYSTEM_ENCRYPTION_CODE_HASH</span> <span class=\"token operator\">=</span> core<span class=\"token punctuation\">.</span>rpc<span class=\"token punctuation\">.</span>paramsFormatter<span class=\"token punctuation\">.</span><span class=\"token function\">toHash</span><span class=\"token punctuation\">(</span>\n    systemCellInfo<span class=\"token punctuation\">.</span>codeHash\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> myAddressObj <span class=\"token operator\">=</span> core<span class=\"token punctuation\">.</span><span class=\"token function\">generateAddress</span><span class=\"token punctuation\">(</span>privateKey<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> blake160edPublicKey <span class=\"token operator\">=</span> core<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">blake160</span><span class=\"token punctuation\">(</span>myAddressObj<span class=\"token punctuation\">.</span>publicKey<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span>\n\n\n  <span class=\"token keyword\">const</span> script <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    codeHash<span class=\"token punctuation\">:</span> <span class=\"token constant\">SYSTEM_ENCRYPTION_CODE_HASH</span><span class=\"token punctuation\">,</span>\n    args<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'0x'</span> <span class=\"token operator\">+</span> blake160edPublicKey<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\nscript: '</span><span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To generate a new wallet， run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node index.js\n\nprivateKey:  0x25395da41ffb99c007ef1e0e2621381577faeeeec486d0943894bba0edacbaeb\naddress:  ckt1q9gry5zgckljj20cxh4k33ufu3q2kxxx2jv0cmk4ykgkhc\n\n\nscript:  { codeHash:\n   &#39;0x9e3b3557f11b2b3532ce352bfe8017e9fd11d154c4c7f9b7aaaa1e621b539a08&#39;,\n  args: [ &#39;0xc5bf2929f835eb68c789e440ab18c65498fc6ed5&#39; ] }</code></pre></div>\n<p>The first two lines of output is the wallet, which is nothing more than a private and public key pair. The later script part is another form for your wallet’s public key, which you can use to replace the node’s default config in ckb.toml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[block_assembler]\n  code_hash = &quot;0x9e3b3557f11b2b3532ce352bfe8017e9fd11d154c4c7f9b7aaaa1e621b539a08&quot;\n  args = [&quot;0xc5bf2929f835eb68c789e440ab18c65498fc6ed5&quot;]</code></pre></div>\n<p>Now Ctrl-C to stop the ckb process, restart again to load the modified config.</p>\n<p>To start mining, we need to open a new terminal and run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ckb miner</code></pre></div>\n<p>Wait for a few minutes, until you see something like this in the console output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2019-05-22 22:04:56.210 +08:00 main INFO miner  found seal: Seal { nonce: 12598543649063525489, proof: 0xf9030000ab350000ad3a0000ab4000007f4600001e4b00005d5200003e5b0000625d00003d6200001e6f000069780000 }</code></pre></div>\n<p>This means I’ve found a seal for a block, and mined a block successfully.</p>\n<p>So we can go to <a href=\"https://explorer.nervos.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://explorer.nervos.org</a> , search our wallet by its address and check to see the reward.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Alright, that is all for this episode, I showed you how to setup a CKB node and mine blocks. Hope you enjoyed it, see you next time.</p>","timeToRead":6,"frontmatter":{"title":"Nervos CKB Mining Tutorial","date":"May 23, 2019","spoiler":"Nervos CKB , that is the layer1 blockchain for Nervos network, testnet launched on May 18th. In this episode I will take you though the process of running a CKB node and mining CKB blocks to get reward. We will be using MacOS as the operating system, CKB Javascript SDK to generate wallet, and the blockchain's explorer to view results.","plink":"https://img.haoqicat.com/2019052401.jpg","video":"https://youtu.be/ZumXJa74mek"},"fields":{"slug":"/007-ckb-mine/","langKey":"en"}}},"pageContext":{"slug":"/007-ckb-mine/","previous":{"fields":{"slug":"/006-value/","langKey":"en","directoryName":"006-value","maybeAbsoluteLinks":[]},"frontmatter":{"title":"The Value Of Bitcoin"}},"next":null,"translations":["zh"],"translatedLinks":[]}}